!function(a){a.fn.quiz=function(){function b(a){this.quizContainer=a,this.quizObj=null,this.quizScore=null,this.userCorrectAnswers=null,this.userChoices={},this.loadQuizContent(),this.displayQuizContent(),this.registerQuizEvents()}return b.prototype.nextQuizStr=function(){var b=this;b.toggleDisableNoErrorButton(),b.unregisterQuizEvents(),this.quizContainer.children("p").not(":hidden").fadeOut(1e3,function(){b.toggleDisableNoErrorButton(),b.registerQuizEvents(),a(this).next().fadeIn(),a("#questionCount").html(parseInt(a("#questionCount").html(),10)+1)})},b.prototype.loadQuizContent=function(){var b=this;a.ajax({url:"app/quiz-content.json",async:!1,success:function(a){b.quizObj=a},error:function(a,b,c){console.error(b),console.error(c)}})},b.prototype.displayQuizContent=function(){var b=this;a.each(this.quizObj,function(c,d){var e="str"+c;b.quizContainer.append("<p id="+e+" class='quizSentence'></p>"),a.each(d.str.split(" "),function(b,c){a("#"+e).append("<span id="+b+" class='quizSpanElement quizSpanElementActive'>"+c+"</span> ")})}),this.quizContainer.prepend("<h3>Question : <span id='questionCount'>1</span> / "+b.quizObj.length+"</h3>"),this.quizContainer.append("<button id='noErrorButton'>Il n'y a pas de faute</button>"),this.quizContainer.children("p").not(":first").hide()},b.prototype.registerQuizEvents=function(){var b=this;a("#noErrorButton,.quizSpanElement").click(function(){b.saveUserChoice(a(this)),b.checkQuizProgress()?b.nextQuizStr():b.endQuiz()}),a(".quizSpanElement").click(function(){b.checkQuizProgress()&&a(this).toggleClass("quizSpanElementHover")})},b.prototype.unregisterQuizEvents=function(){a("#noErrorButton,.quizSpanElement").off()},b.prototype.saveUserChoice=function(b){this.userChoices[a(".quizSentence:visible").attr("id")]=!isNaN(b.attr("id"))&&b.attr("id")},b.prototype.checkQuizProgress=function(){return a("#questionCount").html()<this.quizObj.length},b.prototype.endQuiz=function(){a(".quizSpanElement").removeClass("quizSpanElementActive"),this.unregisterQuizEvents(),a("#quiz-container").empty(),this.getFinalResult(),a("#quiz-container").append('<p class="quizResult">Votre score est de '+this.quizScore+"% ("+this.userCorrectAnswers+" / "+this.quizObj.length+")</p>")},b.prototype.getAllIndexes=function(a,b){var d,c=[];for(d=0;d<a.length;d++)a[d]===b&&c.push(d);return"undefined"!=typeof c[0]?c:[!1]},b.prototype.getFinalResult=function(){var b=this;a.each(this.quizObj,function(a,c){b.userCorrectAnswers+=b.getAllIndexes(c.str.split(" "),c.mistake.name)[c.mistake.occurence]==b.userChoices["str"+a]}),this.quizScore=Math.round(this.userCorrectAnswers/this.quizObj.length*100)},b.prototype.toggleDisableNoErrorButton=function(){a("#noErrorButton").is(":disabled")?a("#noErrorButton").attr("disabled",!1):a("#noErrorButton").attr("disabled","disabled")},new b(a(this))}}(jQuery);
